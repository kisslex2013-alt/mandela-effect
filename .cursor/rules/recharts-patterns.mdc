---
description: Специфичные правила для Recharts - производительность и структура
globs: ["**/*recharts*", "**/*chart*", "**/*Chart*"]
---

# Recharts Patterns: Правила для графиков

## ResponsiveContainer обязателен

**КРИТИЧНО:** Всегда оборачивай графики в `ResponsiveContainer`. Без него charts не адаптируются к размеру контейнера.

```javascript
// ❌ НЕПРАВИЛЬНО
<LineChart width={500} height={300} data={data}>
  <Line dataKey="value" />
</LineChart>

// ✅ ПРАВИЛЬНО
<ResponsiveContainer width="100%" height={400}>
  <LineChart data={data}>
    <Line dataKey="value" />
  </LineChart>
</ResponsiveContainer>
```

**Правило:** "Always wrap charts in ResponsiveContainer with width='100%' height={number}."

## Мемоизация данных

Мemoization данных критична для performance. Используй `useMemo` для data transformations:

```javascript
// ✅ ПРАВИЛЬНО
const formattedData = useMemo(() => {
  return rawData.map(item => ({
    ...item,
    date: formatDate(item.timestamp),
    value: parseFloat(item.value)
  }))
}, [rawData])

<ResponsiveContainer width="100%" height={400}>
  <LineChart data={formattedData}>
    <Line dataKey="value" />
  </LineChart>
</ResponsiveContainer>
```

**Правило:** "Use useMemo for data transformations. Without this, every re-render recalculates data, causing lags on charts with 100+ points."

## Лимит точек данных

Для больших датасетов (>1000 точек) **требуется pagination или summarization**:

```javascript
// ✅ ПРАВИЛЬНО - ограничение точек
const limitedData = useMemo(() => {
  if (data.length > 200) {
    // Sampling: берем каждую N-ю точку
    const step = Math.ceil(data.length / 200)
    return data.filter((_, index) => index % step === 0)
  }
  return data
}, [data])
```

**Правило:** "Limit data points to 100-200 for line charts. Use sampling or aggregation for larger datasets."

## Структура компонента графика

```javascript
function TimeSeriesChart({ data, title, height = 400 }) {
  // Мемоизация данных
  const formattedData = useMemo(() => {
    return data.map(item => ({
      ...item,
      date: formatDate(item.timestamp)
    }))
  }, [data])
  
  // Loading state
  if (!data || data.length === 0) {
    return <EmptyState message="No data available" />
  }
  
  // Error state
  if (data.error) {
    return <ErrorState message={data.error} />
  }
  
  return (
    <div className="w-full">
      {title && <h3 className="text-lg font-semibold mb-4">{title}</h3>}
      <ResponsiveContainer width="100%" height={height}>
        <LineChart data={formattedData}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="date" />
          <YAxis />
          <Tooltip />
          <Legend />
          <Line 
            type="monotone" 
            dataKey="value" 
            stroke="#8884d8" 
            strokeWidth={2}
          />
        </LineChart>
      </ResponsiveContainer>
    </div>
  )
}
```

## Производительность

- Используй `useMemo` для всех data transformations
- Ограничивай количество точек (100-200 для line charts)
- Используй `React.memo` для компонентов графиков, если они часто ре-рендерятся
- Избегай сложных вычислений в render функции
