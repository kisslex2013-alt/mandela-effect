// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Effect {
  id          String  @id @default(cuid())
  title       String
  description String
  content     String
  category    String
  imageUrl    String?
  videoUrl    String?
  
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  votesFor     Int @default(0)
  votesAgainst Int @default(0)
  views        Int @default(0)
  
  // –ù–æ–≤—ã–µ —Ñ–∏—á–∏
  residue          String? // –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ —Å–ª–µ–¥—ã
  residueSource    String? // –°—Å—ã–ª–∫–∞ –¥–ª—è –æ—Å—Ç–∞—Ç–∫–æ–≤
  history          String? // –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è
  historySource    String? // –°—Å—ã–ª–∫–∞ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
  yearDiscovered   Int?
  similarEffectIds String[] @default([]) // –ú–∞—Å—Å–∏–≤ ID –ø–æ—Ö–æ–∂–∏—Ö
  currentState     String? // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Ñ–∞–∫—Ç—ã)
  
  // –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ (–Ω–∞—É—á–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –∏ –≤–µ—Ä—Å–∏–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞)
  interpretations Json?

  // –í–∏–¥–∏–º–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∞
  isVisible Boolean @default(true) // –°–∫—Ä—ã—Ç –ª–∏ —ç—Ñ—Ñ–µ–∫—Ç –æ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞
  
  submissions Submission[] // –°–≤—è–∑—å, –µ—Å–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –∏–∑ –∑–∞—è–≤–∫–∏
  comments    Comment[] // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —ç—Ñ—Ñ–µ–∫—Ç—É

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Submission {
  id String @id @default(cuid())
  
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã
  category String
  title    String
  question String
  variantA String
  variantB String
  
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
  currentState   String? // "–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è"
  sourceLink     String? // "–°—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫"
  submitterEmail String? // "–í–∞—à email"
  
  // –ü–æ–ª–µ –¥–ª—è –±–ª–æ–∫–∞ "–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏" (—Ö—Ä–∞–Ω–∏–º –∫–∞–∫ JSON –æ–±—ä–µ–∫—Ç, —Ç–∞–∫ –∫–∞–∫ —Ç–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ –ø–æ–¥–ø—É–Ω–∫—Ç–æ–≤)
  interpretations Json? 

  // –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è
  status    String   @default("PENDING") // PENDING, APPROVED, REJECTED
  createdAt DateTime @default(now())
  
  // –°–≤—è–∑—å —Å —Å–æ–∑–¥–∞–Ω–Ω—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º (–Ω–∞ –±—É–¥—É—â–µ–µ)
  createdEffectId String?
  createdEffect   Effect? @relation(fields: [createdEffectId], references: [id])
}

model Category {
  id        String   @id @default(cuid())
  slug      String   @unique // –Ω–∞–ø—Ä–∏–º–µ—Ä "films", "brands"
  name      String // –Ω–∞–ø—Ä–∏–º–µ—Ä "–§–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã"
  emoji     String // –Ω–∞–ø—Ä–∏–º–µ—Ä "üé¨"
  color     String? // —Ü–≤–µ—Ç –¥–ª—è –±–µ–π–¥–∂–∞, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä "red", "blue")
  sortOrder Int      @default(0) // –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// –ì–æ–ª–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∞–Ω–æ–Ω–∏–º–Ω–æ–º—É visitorId)
model Vote {
  id        String   @id @default(cuid())
  visitorId String // –ê–Ω–æ–Ω–∏–º–Ω—ã–π ID –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è (–∏–∑ localStorage/cookie)
  effectId  String // ID —ç—Ñ—Ñ–µ–∫—Ç–∞
  variant   String // 'A' –∏–ª–∏ 'B'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([visitorId, effectId]) // –û–¥–∏–Ω –≥–æ–ª–æ—Å –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è
  @@index([visitorId])
  @@index([effectId])
}

// –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–ª—è –±—É–¥—É—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
model UserProfile {
  id         String   @id @default(cuid())
  visitorId  String   @unique // –°–≤—è–∑—å —Å –∞–Ω–æ–Ω–∏–º–Ω—ã–º ID
  email      String?  @unique // Email –¥–ª—è Magic Link (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  provider   String? // 'email', 'google', 'github' (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  providerId String? // ID –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ OAuth (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([email])
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ ID –•—Ä–æ–Ω–æ-–ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞
model IdentityResult {
  id          String   @id @default(cuid())
  syncRate    Int // –ü—Ä–æ—Ü–µ–Ω—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é (0-100)
  archetype   String // –ó–∞–≥–æ–ª–æ–≤–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–°–∫–≤–æ–∑–Ω–æ–π –î—Ä–∏—Ñ—Ç–µ—Ä")
  description String // –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ç AI
  stats       Json? // –•—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º { "films": 80, "brands": 20 }
  createdAt   DateTime @default(now())

  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
  userId String?
  // user User? @relation... (–ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º —Å–≤—è–∑—å –∂–µ—Å—Ç–∫–æ, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å —Ç–µ–∫—É—â—É—é User –º–æ–¥–µ–ª—å –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å)
}

// –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —ç—Ñ—Ñ–µ–∫—Ç–∞–º (–ê—Ä—Ö–∏–≤ –ê–Ω–æ–º–∞–ª–∏–π)
model Comment {
  id        String @id @default(cuid())
  effectId  String // ID —ç—Ñ—Ñ–µ–∫—Ç–∞
  visitorId String // –ê–Ω–æ–Ω–∏–º–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

  // –¢–∏–ø –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  type CommentType // WITNESS, ARCHAEOLOGIST, THEORIST

  // –ö–æ–Ω—Ç–µ–Ω—Ç
  text     String
  imageUrl String? // –í–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–¥–ª—è –ê—Ä—Ö–µ–æ–ª–æ–≥–æ–≤)
  videoUrl String? // –í–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ (–¥–ª—è –ê—Ä—Ö–µ–æ–ª–æ–≥–æ–≤)
  audioUrl String? // –í–Ω–µ—à–Ω—è—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞—É–¥–∏–æ (–¥–ª—è –ê—Ä—Ö–µ–æ–ª–æ–≥–æ–≤)

  // –î–ª—è –¢–µ–æ—Ä–µ—Ç–∏–∫–æ–≤ - –≤—ã–±–æ—Ä –±–∞–∑–æ–≤–æ–π —Ç–µ–æ—Ä–∏–∏
  theoryType String? // "quantum", "timeline", "memory", "simulation", "other"

  // –ú–æ–¥–µ—Ä–∞—Ü–∏—è
  status      CommentStatus @default(PENDING) // PENDING, APPROVED, REJECTED
  moderatedAt DateTime?

  // –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
  likes   Int @default(0)
  dislikes Int @default(0)
  reports Int @default(0)

  // –°–≤—è–∑—å —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º
  effect Effect @relation(fields: [effectId], references: [id], onDelete: Cascade)
  
  // –õ–∞–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  commentLikes CommentLike[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([effectId])
  @@index([visitorId])
  @@index([status])
  @@index([createdAt])
}

// –õ–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
model CommentLike {
  id        String   @id @default(cuid())
  commentId String
  visitorId String
  isLike    Boolean  // true = –ª–∞–π–∫, false = –¥–∏–∑–ª–∞–π–∫
  
  comment Comment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([commentId, visitorId]) // –û–¥–∏–Ω –ª–∞–π–∫/–¥–∏–∑–ª–∞–π–∫ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  @@index([commentId])
  @@index([visitorId])
}

enum CommentType {
  WITNESS // –°–≤–∏–¥–µ—Ç–µ–ª–∏ - –ø—Ä–æ—Å—Ç—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
  ARCHAEOLOGIST // –ê—Ä—Ö–µ–æ–ª–æ–≥–∏ - —Å —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ/–∞—É–¥–∏–æ
  THEORIST // –¢–µ–æ—Ä–µ—Ç–∏–∫–∏ - —Å –≤—ã–±–æ—Ä–æ–º —Ç–µ–æ—Ä–∏–∏
}

enum CommentStatus {
  PENDING
  APPROVED
  REJECTED
}
